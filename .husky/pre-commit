#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if only .md files are being committed
staged_files=$(git diff --cached --name-only)
non_md_files=$(echo "$staged_files" | grep -v '\.md$' || true)

# Always run lint-staged (handles formatting for all files including .md)
npx lint-staged

# Skip heavy checks if only .md files are being committed
if [ -z "$non_md_files" ]; then
  echo "Only .md files detected, skipping type-check and tests"
  exit 0
fi

# Run type checking
pnpm -r type-check

# Run unit tests (fast feedback)
pnpm --filter api test:unit